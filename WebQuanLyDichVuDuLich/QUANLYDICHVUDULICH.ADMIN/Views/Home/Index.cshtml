@model QUANLYDICHVUDULICH.Admin.Models.DashboardViewModel

@{
    ViewBag.Title = "Bảng điều khiển";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-title">Tổng doanh thu</div>
            <div class="stat-value text-primary">@string.Format("{0:N0} đ", Model.TongDoanhThu)</div>
            <div class="stat-trend text-success"><i class="bi bi-graph-up"></i>Thống kê doanh thu</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-title">Tổng lượt đặt</div>
            <div class="stat-value">@Model.TongLuotDat</div>
            <div class="stat-trend text-success">Đơn hàng</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-title">Khách hàng</div>
            <div class="stat-value">@Model.KhachHangMoi</div>
            <div class="stat-trend text-primary">Người dùng</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="stat-card">
            <div class="stat-title">Tour đang mở</div>
            <div class="stat-value">@Model.TourHoatDong</div>
            <div class="stat-trend text-success">Đang hoạt động</div>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-8">
        <div class="content-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="section-title mb-0">Biểu đồ Doanh thu</div>
            </div>
            <canvas id="revenueChart" style="height: 300px;"></canvas>
        </div>
    </div>

    <div class="col-md-4">
        <div class="content-section">
            <div class="section-title">Tour doanh thu cao nhất</div>

            @if (Model.TopTours != null && Model.TopTours.Count > 0)
            {
                foreach (var item in Model.TopTours)
                {
                    <div class="tour-item">
                        <img src="@(string.IsNullOrEmpty(item.HinhAnh) ? "https://via.placeholder.com/60" : item.HinhAnh)" class="tour-img">
                        <div class="tour-info">
                            <h6>@item.TenTour</h6>
                            <span>@item.SoLuotDat lượt đặt</span>
                        </div>
                        <div class="tour-price text-primary">@string.Format("{0:0,0} đ", item.DoanhThu)</div>
                    </div>
                }
            }
            else
            {
                <p class="text-muted text-center">Chưa có dữ liệu đặt tour.</p>
            }
        </div>
    </div>
</div>

@section scripts {
    <script>
        // Giữ nguyên script vẽ biểu đồ cho đẹp giao diện
        var ctx = document.getElementById('revenueChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Thg 1', 'Thg 2', 'Thg 3', 'Thg 4', 'Thg 5', 'Thg 6'],
                datasets: [{
                    label: 'Doanh thu',
                    data: [65, 30, 80, 20, 90, 45], // Sau này làm API trả về mảng này sau
                    backgroundColor: '#0d6efd',
                    borderRadius: 5,
                    barThickness: 30
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } } }
        });
    </script>
}